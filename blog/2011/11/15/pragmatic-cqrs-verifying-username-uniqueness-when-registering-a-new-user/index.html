
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Pragmatic CQRS: Verifying username uniqueness when registering a new user - Tom's ramblings</title>
	<meta name="author" content="Tom Janssens">

	
	<meta name="description" content="Pragmatic CQRS: Verifying Username Uniqueness When Registering a New User Introduction
Most people who get started with CQRS have issues with this &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Tom's ramblings" type="application/atom+xml">
	
	<link rel="canonical" href="http://tojans.github.io/blog/2011/11/15/pragmatic-cqrs-verifying-username-uniqueness-when-registering-a-new-user/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("tom@corebvba.be") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
</div>
<hgroup>
  <h1><a href="/">Tom's ramblings</a></h1>
  
    <p class="subtitle">Random opinionated blurbs</p>
  
</hgroup>

<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About Tom</a></li>
</ul>


<section class="aboutme">
  <p>
    <p>Tom builds software and helps organisations to get better at building software.</p>

  </p>
</section>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/tojans" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/tojans" title="GitHub">GitHub</a>
		
		
		
		<a class="linkedin" href="http://www.linkedin.com/in/tomjanssens">LinkedIn</a>
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Pragmatic CQRS: Verifying Username Uniqueness When Registering a New User</h1>
	<div class="entry-content" itemprop="articleBody"><h3>Introduction</h3>
<p>Most people who get started with CQRS have issues with this classical example: &#8220;how do we verify username uniqueness when a new user registers ?&#8221;.</p>
<p>While user authentication is something that has been implemented numerous amounts of times before, and one should usually not reinvent the wheel but use an existing software library for this particular case, the problem in itself is rather interesting, and happens quite a lot in a domain.</p>
<p>
<script src="https://gist.github.com/1366502.js?file=00%20Old%20specs.txt"></script>
</p>
<p>In this small article I will show you a simple proper way to resolve the issue respecting CQRS/DDD principles.</p>
<p></p>
<h3><br /></h3>
<h3>Is that really what we want ?</h3>
<p>Let us think about another way to solve the issue. I will rewrite the scenario a little bit:</p>
<p>
<script src="https://gist.github.com/1366502.js?file=01%20New%20specs.txt%20"></script>
</p>
<h3><br /></h3>
<h3>Great, now we have a pending registration ! How is that helpful ?</h3>
<p>Not so quick! I have a rule of thumb: whenever I have to communicate between different AR&#8217;s (even the ones of the same AR type), I use a saga. What is uniqueness validation when you think about it ? Exactly !! A question to all the other AR&#8217;s whether an entity with the same properties exists. So let us have a second scenario for the saga:</p>
<p>
<script src="https://gist.github.com/1366502.js?file=03%20The%20saga%20specs"></script>
</p>
<p>Please note that scenario&#8217;s for sagas are a little different:</p>
<p>
<script src="https://gist.github.com/1366502.js?file=04%20Saga%20specs%20template"></script>
</p>
<h3><br /></h3>
<h3>Example code</h3>
<p>
<script src="https://gist.github.com/1366502.js?file=05%20Example%20saga.cs"></script>
</p>
<h3><br /></h3>
<h3>Conclusion</h3>
<p>There you have it, a simple and elegant solution to a problem everybody struggles with in the beginning.</p><div style="text-align:right"><a class="addthis_button" href="http://www.addthis.com/bookmark.php?v=250&amp;pub=xa-4aec37702e3161d4"><img src="http://s7.addthis.com/static/btn/v2/lg-share-en.gif" width="125" height="16" alt="Bookmark and Share" style="border:0"/></a><script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pub=xa-4aec37702e3161d4"></script></div>
</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2013 - Tom Janssens -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'tojansramblings';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-41936060-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>




		</div>
	</div>
</body>
</html>
